name: Anvxl Comment Requested

on:
  issue_comment:
    types: [created]

jobs:
  update-docs:
    # Only run on PR comments that contain the trigger phrase docs
    if: |
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '@anvxl docs')
    permissions:
      contents: write
      pull-requests: write
    uses: ./.github/workflows/docs-reusable.yml
    with:
      mode: 'pr'
      model: 'google/gemini-2.5-pro'
      pr_branch_prefix: 'docs/auto-update'
      file_patterns: '**/*.md,docs/**'
      deny_patterns: 'vendor/**,.git/**'
      max_tokens: 2000000
      custom_instructions: |
        Be thorough but concise. Ensure all technical details are accurate.
    secrets:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
      GH_APP_ID: ${{ secrets.GH_APP_ID }}
      GH_APP_PRIVATE_KEY: ${{ secrets.GH_APP_PRIVATE_KEY }}
  
  review:
    # Only run on PR comments that contain the trigger phrase review
    if: |
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '@anvxl review')
    permissions:
      contents: read
      pull-requests: write
    uses: ./.github/workflows/review-reusable.yml
    with:
      model: 'google/gemini-2.5-pro'
      max_tokens: 2000000
      custom_instructions: |
        Be thorough but concise. Ensure all technical details are accurate in your review.
    secrets:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
      GH_APP_ID: ${{ secrets.GH_APP_ID }}
      GH_APP_PRIVATE_KEY: ${{ secrets.GH_APP_PRIVATE_KEY }}
  
  create-tests:
    # Only run on PR comments that contain the trigger phrase tests
    if: |
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '@anvxl tests')
    permissions:
      contents: write
      pull-requests: write
    uses: ./.github/workflows/tests-reusable.yml
    with:
      mode: 'pr'
      model: 'google/gemini-2.5-pro'
      pr_branch_prefix: 'tests/auto-generate'
      file_patterns: '**/*.go'
      max_tokens: 2000000
      quality_gates: |
        [
          {"name": "Test", "command": "make test"},
          {"name": "Format", "command": "make fmt"},
          {"name": "Lint", "command": "make lint"}
        ]
      custom_instructions: |
        Write comprehensive tests with clear descriptions. Focus on edge cases and error handling.
    secrets:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
      GH_APP_ID: ${{ secrets.GH_APP_ID }}
      GH_APP_PRIVATE_KEY: ${{ secrets.GH_APP_PRIVATE_KEY }}
